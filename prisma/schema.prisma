generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Mood {
  VERY_SAD
  SAD
  NEUTRAL
  HAPPY
  VERY_HAPPY
}

enum NoteSize {
  SMALL
  MEDIUM
  LARGE
}

enum Status {
  PENDING
  COMPLETED
  CANCELLED
  OUTDATED
}

model User {
  id             Int         @id @default(autoincrement())
  name           String
  email          String      @unique
  password       String
  birthDate      DateTime
  gender         String
  avatar         String?
  createdAt      DateTime    @default(now())
  deletedAt      DateTime?
  isAdmin        Boolean     @default(false)
  isPremium      Boolean     @default(false)
  is2FAEnabled   Boolean     @default(false)
  isPsychologist Boolean     @default(false)
  isRoleSet      Boolean     @default(false)
  twoFactors     TwoFactor[]
  notes   Note[]
  goals   Goal[]
  weeklyReports  WeeklyReport[]
  monthtly MonthlyReport[]
  streak Streak?
  psychotherapy Psychotherapy[]
  psychologistSessions Psychotherapy[] @relation("PsychologistSessions")
}

model TwoFactor {
  id        Int      @id @default(autoincrement())
  userId    Int
  codeHash  String
  expiresAt DateTime
  attempts  Int      @default(0)
  createdAt DateTime @default(now())
  used      Boolean  @default(false)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model DailyQuote {
  id           Int                    @id @default(autoincrement())
  text         String
  author       String
  createdAt    DateTime               @default(now())
  translations DailyQuoteTranslation[] @relation("QuoteTranslations")
}

model Color {
  id        Int      @id @default(autoincrement())
  name      String
  hexCode   String   @unique
  createdAt DateTime @default(now())
  notes     Note[]
}

model DailyQuoteTranslation {
  id        Int        @id @default(autoincrement())
  quoteId   Int
  language  String
  text      String
  createdAt DateTime   @default(now())
  quote     DailyQuote @relation("QuoteTranslations", fields: [quoteId], references: [id], onDelete: Cascade)
}

model Note {
  id        Int      @id @default(autoincrement())
  userId    Int
  mood      Mood
  size      NoteSize     
  title     String
  content   String
  colorid   Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
  color     Color?   @relation(fields: [colorid], references: [id])
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Goal {
  id          Int      @id @default(autoincrement())
  userId      Int
  title       String
  description String?
  dueDate     DateTime?
  status      Status   @default(PENDING)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WeeklyReport {
  id               Int       @id @default(autoincrement())
  userId           Int
  startDate        DateTime
  endDate          DateTime
  averageMood      Mood?
  moodDistribution Json
  notesCount       Int       @default(0)
  completedGoals   Int       @default(0)
  pendingGoals     Int       @default(0)
  moodTrend        Int?      // -1, 0, 1
  mostActiveHour   Int?
  daysActive       Int       @default(0)
  alert            Boolean   @default(false)
  therapistNotes   String?
  createdAt        DateTime  @default(now())
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MonthlyReport {
  id           Int       @id @default(autoincrement())
  userId       Int
  month        DateTime
  averageMood  Mood
  moodDistribution Json
  moodVolatility Float
  bestWeek     DateTime?
  worstWeek    DateTime?
  totalNotes   Int
  activeDays   Int
  mostActiveHour Int?
  completedGoals Int
  pendingGoals Int
  successRate  Float
  progressComparedToLastMonth Json?
  alert        Boolean
  recommendation String?
  createdAt    DateTime @default(now())

  user         User @relation(fields: [userId], references: [id])
}

model Streak {
  id Int @id @default(autoincrement())
  userId Int @unique
  currentStreak Int @default(0)
  longestStreak Int @default(0)
  lastActive DateTime?
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  DeletedAt DateTime?
}

model Psychotherapy {
  id               Int               @id @default(autoincrement())
  userId           Int
  psychologistId   Int
  dayOfWeek        String?           
  time             String?           
  sessionDuration  Int?              
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  deletedAt        DateTime?

  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  psychologist     User              @relation("PsychologistSessions", fields: [psychologistId], references: [id], onDelete: Cascade)

  therapySessions  TherapySession[]  
}

model TherapySession {
  id               Int               @id @default(autoincrement())
  psychotherapyId  Int
  sessionDate      DateTime          
  attended         Boolean           @default(false)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  deletedAt        DateTime?

  psychotherapy    Psychotherapy     @relation(fields: [psychotherapyId], references: [id], onDelete: Cascade)
  sessionNote      SessionNote?
}

model SessionNote {
  id               Int               @id @default(autoincrement())
  therapySessionId Int?              @unique
  noteText         String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  therapySession   TherapySession?   @relation(fields: [therapySessionId], references: [id])
}